import{u as D,a as Q,b as Z,_ as R,D as oe,c as ae,S as K,g as se,s as W,d as le,e as G,f as q,T as B,h as ce}from"./index-1b90fc84.js";import{b as ie,u as Y}from"./vue-router-70c5f815.js";import{_ as T}from"./Icon-5fc0e0ae.js";import{i as L,j as ee,A as ue,M as _e,k as re,l as pe,B as de,n as me,o as ve,p as he,D as fe}from"./ant-design-vue-ebd62544.js";import{d as U,c as z,b as x,w as ge,u as c,W as _,a0 as O,v as a,a5 as u,F as V,a1 as J,t as H,a9 as E,X as b,a3 as v,a4 as g,h as X,o as ne,E as ye,ac as ke,ad as Se,a2 as F,n as Ie,I as j,V as te,ae as be,af as $e}from"./common-10c167db.js";import{L as we}from"./LangSelect-3c84b577.js";import"//at.alicdn.com/t/c/font_4057669_5w7vhnmayto.js";const Ce={key:0,class:"menus"},Ae=U({__name:"Menus",setup(M){const C=L.SubMenu,y=D(),{t:S}=Q(),{auth:m}=Z(),$=ie(),I=Y(),p=z(()=>{let o=[];return y.menus.forEach(n=>{var l;o.push(n.i18n_id),(l=n.items)!=null&&l.length&&n.items.filter(r=>r.open_way!==3).forEach(r=>o.push(r.i18n_id))}),o}),d=z(()=>m("hidePlantMenu")),h=x(["home"]);ge(()=>$.path,()=>{const{path:o,name:n}=$;if(o.startsWith("/plant")&&d.value)h.value=["home"];else if(n&&p.value.includes(n))h.value=[n];else{const l=o.split("/");l[2]&&p.value.includes(l[2])?h.value=[l[2]]:l[1]&&p.value.includes(l[1])?h.value=[l[1]]:h.value=["home"]}},{immediate:!0});const w=({key:o})=>{h.value=[o],I.push({name:o})},f=(o,n=!1)=>{const l=o.i18n_id==="plant"&&d.value,r=o.i18n_id==="home"&&d.value;let t=r?"jianshe-1,jianshe2":o.icon||"";const e=(t==null?void 0:t.split(","))||["Setting","dianzhanxiangqingfenye-9"],s=()=>X(T,{name:e[0]}),i=()=>X(T,{name:e[1]||"dianzhanxiangqingfenye-9"});return{key:o.i18n_id,label:S(r?"common.plant":`common.${o.i18n_id}`),title:S(r?"common.plant":`common.${o.i18n_id}`),iconName:n?void 0:e[0],icon:n?void 0:s,activeIconName:n?void 0:e[1],activeIcon:n?void 0:i,hidden:l}},k=z(()=>y.menus.filter(o=>o.open_way!==3).map(o=>{var l;const n=(l=o.items)==null?void 0:l.filter(r=>r.open_way!==3);return{...f(o),children:n!=null&&n.length?n==null?void 0:n.map(r=>f(r,!0)):void 0,childKeys:n!=null&&n.length?n==null?void 0:n.map(r=>r.i18n_id):[]}}));return(o,n)=>{var t;const l=ee,r=L;return(t=c(k))!=null&&t.length?(_(),O("div",Ce,[a(r,{selectedKeys:c(h),"onUpdate:selectedKeys":n[0]||(n[0]=e=>H(h)?h.value=e:null),mode:"horizontal",onClick:w},{default:u(()=>[(_(!0),O(V,null,J(c(k).filter(e=>!e.hidden),e=>{var s;return _(),O(V,{key:e==null?void 0:e.key},[(s=e.children)!=null&&s.length?(_(),b(c(C),{key:e==null?void 0:e.iconName,title:e.title},{icon:u(()=>[e.childKeys.includes(c(h)[0])?(_(),b(T,{key:0,name:e.activeIconName},null,8,["name"])):E("",!0),a(T,{name:e.iconName},null,8,["name"])]),default:u(()=>[(_(!0),O(V,null,J(e.children,i=>(_(),b(l,{key:i==null?void 0:i.key},{default:u(()=>[v("span",null,g(i.title),1)]),_:2},1024))),128))]),_:2},1032,["title"])):(_(),b(l,{key:e==null?void 0:e.key},{icon:u(()=>[c(h)[0]===e.key?(_(),b(T,{key:0,name:e.activeIconName},null,8,["name"])):E("",!0),a(T,{name:e.iconName},null,8,["name"])]),default:u(()=>[v("span",null,g(e.title),1)]),_:2},1024))],64)}),128))]),_:1},8,["selectedKeys"])])):E("",!0)}}});const Ne=R(Ae,[["__scopeId","data-v-4b964263"]]),Oe=["onClick"],Me={key:1,class:"suggestion_item"},Te={class:"value"},xe=U({__name:"Search",setup(M){const{t:C}=Q(),y=Y(),S={0:"plant",1:"deviceDtu",2:"deviceRepeater",3:"deviceMicro",4:"",5:"deviceMeter",6:"deviceInverter",7:"deviceRsd",8:"deviceOptimizer",9:"",10:"",21:""},m=x();ne(()=>{const t={};for(const e in S){const s=S[e];s&&y.hasRoute(s)?t[e]=s:t[e]=""}m.value=t});const $=x(!1),I=x(),p=x(""),d=x([]),h=z(()=>!p.value&&d.value.length>0?d.value.concat([{value:-1,label:C("common.clearHistory")}]):d.value),w=()=>{$.value=!0,Ie(()=>{var t;(t=I.value)==null||t.focus(),n()})},f=()=>{$.value=!1,p.value=""},k=async(t,e)=>{var N;if(t===-1||!e)return;(N=I.value)==null||N.blur();const s=localStorage.getItem(K);if(s){const A=JSON.parse(s);Array.isArray(A)&&!A.find(P=>e.label===P.label)&&(A.length>4&&A.pop(),A.unshift(e),localStorage.setItem(K,JSON.stringify(A)))}else localStorage.setItem(K,JSON.stringify([e]));const i=S[t];t===0?y.push({name:i,query:{name:e.label}}):y.push({name:i,query:{sn:e.label}})},o=()=>{p.value="",d.value=[],localStorage.removeItem(K)},n=()=>{const t=localStorage.getItem(K);if(t){const e=JSON.parse(t);(e==null?void 0:e.length)>0&&(d.value=e.filter(s=>{var i;return!!s.label&&((i=m.value)==null?void 0:i[s.value])}))}else d.value=[]},l=t=>{if(t){t.length===12&&(p.value=t.toUpperCase());let e=se(p.value);(e===102||e===104)&&(e=1),m.value&&!m.value[e]&&(e=0);const s=Number(t);e!==0&&!isNaN(s)&&100<s&&s<99e7&&(e=0),d.value=[{label:p.value,value:e}]}else n()},r=()=>{d.value.length>0&&k(d.value[0].value,void 0)};return(t,e)=>{const s=T;return _(),O("div",{class:F(["search",{active:c($)}])},[a(s,{name:"Search",onClick:w}),a(c(ue),{ref_key:"inputRef",ref:I,value:c(p),"onUpdate:value":e[0]||(e[0]=i=>H(p)?p.value=i:null),bordered:!1,style:{width:"200px"},"popup-class-name":!c(p)&&c(d).length>0?"has_clear":"",placeholder:t.$t("plant.inputNameOrId"),size:"small",options:c(h),onBlur:f,onSelect:k,onSearch:l,onKeyup:Se(r,["enter"])},{option:u(({label:i,value:N})=>[N===-1?(_(),O("p",{key:0,class:"clear_history",onClick:ye(o,["stop"])},g(i),9,Oe)):(_(),O("p",Me,[a(s,{name:c(oe)[N]||"guangfu2",style:ke({color:c(ae)[N]||"#2FC774"})},null,8,["name","style"]),v("span",Te,g(t.$t("common.search"))+" "+g(i),1)]))]),_:1},8,["value","popup-class-name","placeholder","options","onKeyup"])],2)}}});const Ee=R(xe,[["__scopeId","data-v-47cee90d"]]),ze=["onClick"],Re={class:"between"},Ue={class:"tip"},Ke=U({__name:"SwitchAccountModal",props:{visible:{type:Boolean}},emits:["update:visible"],setup(M,{emit:C}){const y=M,S=D(),{bindUser:m,mainAccountInfo:$,userInfo:I}=W(S),p=x({}),d=z({get:()=>y.visible,set:w=>C("update:visible",w)}),h=async(w,f)=>{if(w.auid===I.value.id||Object.values(p.value).some(o=>o))return;let k=localStorage.getItem(G);if(k||(k=q.get(B)),k){localStorage.setItem(G,k),p.value[f]=!0;const{error:o,data:n}=await ce.switchAccount(k,w.auid);o||(q.set(B,n.token),localStorage.setItem(B,n.token),window.location.reload()),p.value[f]=!1}};return(w,f)=>{const k=T,o=pe,n=de,l=me,r=ve,t=le,e=_e;return _(),b(e,{open:c(d),"onUpdate:open":f[1]||(f[1]=s=>H(d)?d.value=s:null),width:"800px",class:"custom",title:w.$t("common.switchUser"),"destroy-on-close":"",footer:null},{default:u(()=>{var s;return[(_(!0),O(V,null,J(c(m),(i,N)=>(_(),b(r,{key:i.uid,spinning:!!c(p)[N]},{default:u(()=>[v("div",{class:F(["user",{active:i.auid===c(I).id}]),onClick:A=>h(i,N)},[a(l,null,{default:u(()=>[a(o,{class:"item",span:2},{default:u(()=>{var A;return[((A=c($))==null?void 0:A.uid)===i.auid?(_(),b(k,{key:0,name:"guanliyuanzhanghao"})):E("",!0)]}),_:2},1024),a(o,{class:"item name",span:5},{default:u(()=>[j(g(i.user_name||i.email),1)]),_:2},1024),a(o,{class:"item",span:15},{default:u(()=>[j(g(i.gname)+" / "+g(i.pgname),1)]),_:2},1024),a(o,{span:2},{default:u(()=>[i.auid===c(I).id?(_(),b(n,{key:0,type:"link",size:"small"},{default:u(()=>[a(k,{name:"chenggong"})]),_:1})):(_(),b(n,{key:1,type:"link",size:"small"},{default:u(()=>[a(c(re),{class:"btn"})]),_:1}))]),_:2},1024)]),_:2},1024)],10,ze)]),_:2},1032,["spinning"]))),128)),v("div",Re,[v("span",Ue,"* "+g(w.$t("login.switchAccountTip")),1),((s=c($))==null?void 0:s.uid)===c(I).id?(_(),b(t,{key:0,to:{name:"accountBind"},onClick:f[0]||(f[0]=i=>d.value=!1)},{default:u(()=>[j(g(w.$t("login.manageSubAccount"))+" ",1),a(k,{name:"bianji1",left:"4"})]),_:1})):E("",!0)])]}),_:1},8,["open","title"])}}});const Be=R(Ke,[["__scopeId","data-v-8825b192"]]),Ve=M=>(be("data-v-4ba78be2"),M=M(),$e(),M),De={class:"avatar center"},He={class:"name ellipsis"},Pe={class:"full_name"},je={class:"type"},qe=Ve(()=>v("div",{class:"divider"},null,-1)),Le=U({__name:"Avatar",setup(M){const{auth:C}=Z(),y=Y(),S=D(),{userInfo:m,bindUser:$,userSubAccount:I}=W(S),p=z(()=>(I.value||C(29679))&&I.value!==99&&!C("isOemWeb")),d=()=>{q.remove(B),localStorage.removeItem(B),y.replace({name:"login"})},h=x(!1),w=l=>{h.value=l},f=x(),k=()=>{$.value.length?f.value=!0:y.push({name:"accountBind"})},o=()=>{y.push({name:"accountOApi"})},n=()=>{y.push({name:"accountNote"})};return ne(()=>{C("isGroupUser")&&!C("isDiyUser")&&S.getBindUser()}),(l,r)=>{const t=T,e=he,s=ee,i=te("router-link"),N=L,A=fe;return _(),O(V,null,[a(A,{onOpenChange:w},{overlay:u(()=>[a(N,{class:"avatar_menu"},{default:u(()=>[a(s,{class:"info"},{default:u(()=>[v("p",Pe,g(c(m).user_name),1),v("p",je,g(l.$filters.userTypeLabel(c(m).type)),1),qe]),_:1}),a(s,null,{default:u(()=>[a(i,{to:"/account/info"},{default:u(()=>[a(t,{name:"geren1"}),v("span",null,g(l.$t("common.accountInfo")),1)]),_:1})]),_:1}),c(p)?(_(),b(s,{key:0,onClick:k},{default:u(()=>[a(t,{name:"qiehuanzhanghao"}),v("span",null,g(l.$t("common.switchUser")),1)]),_:1})):E("",!0),l.$auth("hasOapiService")?(_(),b(s,{key:1,onClick:o},{default:u(()=>[a(t,{name:"oapi"}),v("span",null,g(l.$t("common.oapiService")),1)]),_:1})):E("",!0),l.$auth("isPlatformOrGroupUser")?(_(),b(s,{key:2,onClick:n},{default:u(()=>[a(t,{name:"xiaoxi1"}),v("span",null,g(l.$t("common.messageNote")),1)]),_:1})):E("",!0),a(s,{onClick:d},{default:u(()=>[a(t,{name:"tuichu"}),v("span",null,g(l.$t("common.logout")),1)]),_:1})]),_:1})]),default:u(()=>[v("div",De,[a(e,{size:32},{icon:u(()=>[a(t,{name:"yonghuzhanghao",size:"18"})]),_:1}),v("span",He,g(c(m).name||c(m).user_name),1),a(t,{name:"xia",class:F(["arrow",{open:c(h)}])},null,8,["class"])])]),_:1}),c(f)!==void 0?(_(),b(Be,{key:0,visible:c(f),"onUpdate:visible":r[0]||(r[0]=P=>H(f)?f.value=P:null)},null,8,["visible"])):E("",!0)],64)}}});const Je=R(Le,[["__scopeId","data-v-4ba78be2"]]),We={class:"actions"},Ye=U({__name:"Actions",setup(M){return(C,y)=>(_(),O("div",We,[a(Ee),a(we),a(Je)]))}});const Fe=R(Ye,[["__scopeId","data-v-7830f662"]]),Ge={class:"nav"},Xe={class:"menus"},Qe={class:"logo"},Ze=["src","srcset"],en=U({__name:"index",setup(M){const C=D(),{menus:y}=W(C),S=z(()=>{var m;return y.value.some($=>$.path==="/home")?{path:"/home"}:{path:((m=y.value[0])==null?void 0:m.path)||"/home"}});return(m,$)=>{const I=te("router-link");return _(),O("div",Ge,[v("div",Xe,[v("div",Qe,[a(I,{to:c(S)},{default:u(()=>[v("img",{src:m.$assetsImg("nav/logo.png"),alt:"logo",srcset:`${m.$assetsImg("nav/logo@2x.png")} 2x`},null,8,Ze)]),_:1},8,["to"])]),a(Ne)]),a(Fe)])}}});const un=R(en,[["__scopeId","data-v-a41e4f95"]]);export{un as default};
